{% extends 'shop/basic.html' %}
{% block title %} Mayinsoft.com {% endblock %}
{% block body %}
<div class="container" >
  <div class="col my-4">
    <h2>Step 1 - Mayinsoft.com Express Checkout - Review Your Cart items</h2>
    <div class="my-4">
      <ul class="list-group" id="items">
      </ul>
    </div>
  </div>

  <div class="col my-4">
    <h2> Step 2 - Enter Address & Other Details</h2>
    <form>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="name">Name</label>
                <input type="name" class="form-control" id="name" placeholder="Name">
            </div>
            <div class="form-group col-md-6">
                <label for="inputEmail4">Email</label>
                <input type="email" class="form-control" id="inputEmail4" placeholder="Email">
            </div>
        </div>
        <div class="form-group">
            <label for="inputAddress">Address</label>
            <input type="text" class="form-control" id="inputAddress" placeholder="1234 Main St">
        </div>
        <div class="form-group">
            <label for="inputAddress2">Address Line 2</label>
            <input type="text" class="form-control" id="inputAddress2" placeholder="Apartment, studio, or floor">
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="inputCity">City</label>
                <input type="text" class="form-control" id="inputCity">
            </div>
            <div class="form-group col-md-4">
                <label for="inputState">State</label>
                <input type="text" class="form-control" id="inputAddress" placeholder="Enter State">
                </select>
            </div>
            <div class="form-group col-md-2">
                <label for="inputZip">Zip</label>
                <input type="text" class="form-control" id="inputZip">
            </div>
        </div>
        <div class="form-group">
            <label for="inputZip">Phone Number</label>
            <input type="tel" class="form-control" id="inputPhone">
        </div>
        <button type="submit" class="btn btn-primary">Place Order</button>
    </form>

  </div>
</div>

{% endblock %}

{% block js %} 
<script>
    

    //find out the cart item from localstorage
    if(localStorage.getItem('cart') == null)
    {
    var cart={};
    }
    else{
      cart= JSON.parse(localStorage.getItem('cart'));
    }
    console.log(cart);
    
    function renderCart() {
        var sum = 0;
        if ($.isEmptyObject(cart)) {
        // If object is empty
            mystr = "<p>Your cart is empty, please add some items before checking out ! </p>"
            $('#items').append(mystr);
        }
        else{
            for (item in cart){
                let name = cart[item][1];
                let  qty = cart[item][0];
                sum = sum + qty;
                mystr=`<li class="list-group-item d-flex justify-content-between align-items-center">
                          ${name}
                        <div >
                            <button class="btn btn-primary minus" data-item="${item}">-</button>
                            <span id="val-${item}">${qty}</span>
                            <button class="btn btn-primary plus" data-item="${item}">+</button>
                        </div>
                       </li>`
                $('#items').append(mystr);       
            }
        }
        document.getElementById('cart').innerHTML = sum;
    
    
    }
    $(document).ready(function() {
        renderCart(); // Initial render

        // Event delegation for minus button
        $('#items').on('click', '.minus', function() {
            let cart = JSON.parse(localStorage.getItem('cart'));
            const item = $(this).data('item');
            
            if (cart[item][0] > 1) {
                cart[item][0]--;
            } else {
                delete cart[item];
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            $(`#val-${item}`).text(cart[item] ? cart[item][0] : 0); // Update quantity directly
            updateCartSum();
            
        });

        // Event delegation for plus button
        $('#items').on('click', '.plus', function() {
            let cart = JSON.parse(localStorage.getItem('cart'));
            const item = $(this).data('item');
            
            cart[item][0]++;
            localStorage.setItem('cart', JSON.stringify(cart));
            $(`#val-${item}`).text(cart[item][0]); // Update quantity directly
            updateCartSum();
            
        });
        // Function to update the total cart count
        function updateCartSum() {
            let sum = 0;
            for (let item in cart) {
                sum += cart[item][0];
            }
            document.getElementById('cart').innerHTML = sum;
            
        }
        
        
    });
    
</script> 
{% endblock%}
